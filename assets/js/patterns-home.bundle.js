!function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){window.mobile_navigation=e("./patterns/mobile-navigation.js"),window.non_flexbox_grid=e("./patterns/non-flexbox-grid.js")},{"./patterns/mobile-navigation.js":2,"./patterns/non-flexbox-grid.js":3}],2:[function(e,t,n){(function(e){t.exports=function(e,t){var n={};return n.init=function(){n.cache(),n.meetsRequirements&&n.bindEvents()},n.cache=function(){n.$c={window:t(e),mobileNavMenuContainer:t(".mobile-nav-menu"),menuItemCount:t(".mobile-nav-menu .mobile-nav > li").length}},n.bindEvents=function(){n.$c.menuItemCount<=5&&exit,n.replaceLastMenuItem(),t("body").on("click",".mobile-menu-more-link",n.displayMoreItems),t("body").on("click",".mobile-nav-menu .menu-item-has-children a",n.setSecondClick),t("body").on("click",".close-mobile-menu",n.hideMoreItems)},n.meetsRequirements=function(){return n.$c.mobileNavMenuContainer.length},n.replaceLastMenuItem=function(){t(".mobile-nav-menu .mobile-nav > li:nth-child(4)").after('<li class="mobile-menu-more-link"><a href="#"><span><i class="more-icon"></i>More</span></a></li>')},n.displayMoreItems=function(e){return e.preventDefault(),t("body").hasClass("mobile-menu-more")&&!t("body").hasClass("sub-menu-more")?void n.removeMenuClasses():(n.removeMenuClasses(),n.$c.mobileNavMenuContainer.toggleClass("more"),void t("body").toggleClass("mobile-menu-more"))},n.setSecondClick=function(e){console.log("child click",this),t(this).parent("li").hasClass("visible")||e.preventDefault(),n.removeMenuClasses(),t(this).parent("li").toggleClass("visible"),n.$c.mobileNavMenuContainer.toggleClass("more"),t("body").toggleClass("mobile-menu-more sub-menu-more")},n.hideMoreItems=function(){n.removeMenuClasses()},n.removeMenuClasses=function(){t("body").removeClass("mobile-menu-more sub-menu-more"),n.$c.mobileNavMenuContainer.removeClass("more"),t(".menu-item-has-children").removeClass("visible")},t(n.init),n}(window,"undefined"!=typeof window?window.jQuery:"undefined"!=typeof e?e.jQuery:null)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){(function(n){t.exports=function(t,n){var o={};e("./vendor/jquery.matchHeight.js");return o.init=function(){o.cache(),o.meetsRequirements&&o.bindEvents()},o.cache=function(){o.$c={window:n(t),gridItem:n(".grid-item")}},o.bindEvents=function(){o.$c.window.on("load",o.matchGridItems)},o.meetsRequirements=function(){return o.$c.gridItem.length},o.matchGridItems=function(){o.$c.gridItem.matchHeight({byRow:!0,property:"height",target:null,remove:!1})},n(o.init),o}(window,"undefined"!=typeof window?window.jQuery:"undefined"!=typeof n?n.jQuery:null)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./vendor/jquery.matchHeight.js":4}],4:[function(e,t,n){(function(e){!function(n){"use strict";"function"==typeof define&&define.amd?define(["jquery"],n):"undefined"!=typeof t&&t.exports?t.exports=n("undefined"!=typeof window?window.jQuery:"undefined"!=typeof e?e.jQuery:null):n(jQuery)}(function(e){var t=-1,n=-1,o=function(e){return parseFloat(e)||0},i=function(t){var n=1,i=e(t),r=null,a=[];return i.each(function(){var t=e(this),i=t.offset().top-o(t.css("margin-top")),s=a.length>0?a[a.length-1]:null;null===s?a.push(t):Math.floor(Math.abs(r-i))<=n?a[a.length-1]=s.add(t):a.push(t),r=i}),a},r=function(t){var n={byRow:!0,property:"height",target:null,remove:!1};return"object"==typeof t?e.extend(n,t):("boolean"==typeof t?n.byRow=t:"remove"===t&&(n.remove=!0),n)},a=e.fn.matchHeight=function(t){var n=r(t);if(n.remove){var o=this;return this.css(n.property,""),e.each(a._groups,function(e,t){t.elements=t.elements.not(o)}),this}return this.length<=1&&!n.target?this:(a._groups.push({elements:this,options:n}),a._apply(this,n),this)};a.version="0.7.0",a._groups=[],a._throttle=80,a._maintainScroll=!1,a._beforeUpdate=null,a._afterUpdate=null,a._rows=i,a._parse=o,a._parseOptions=r,a._apply=function(t,n){var s=r(n),l=e(t),u=[l],c=e(window).scrollTop(),d=e("html").outerHeight(!0),f=l.parents().filter(":hidden");return f.each(function(){var t=e(this);t.data("style-cache",t.attr("style"))}),f.css("display","block"),s.byRow&&!s.target&&(l.each(function(){var t=e(this),n=t.css("display");"inline-block"!==n&&"flex"!==n&&"inline-flex"!==n&&(n="block"),t.data("style-cache",t.attr("style")),t.css({display:n,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px",overflow:"hidden"})}),u=i(l),l.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||"")})),e.each(u,function(t,n){var i=e(n),r=0;if(s.target)r=s.target.outerHeight(!1);else{if(s.byRow&&i.length<=1)return void i.css(s.property,"");i.each(function(){var t=e(this),n=t.attr("style"),o=t.css("display");"inline-block"!==o&&"flex"!==o&&"inline-flex"!==o&&(o="block");var i={display:o};i[s.property]="",t.css(i),t.outerHeight(!1)>r&&(r=t.outerHeight(!1)),n?t.attr("style",n):t.css("display","")})}i.each(function(){var t=e(this),n=0;s.target&&t.is(s.target)||("border-box"!==t.css("box-sizing")&&(n+=o(t.css("border-top-width"))+o(t.css("border-bottom-width")),n+=o(t.css("padding-top"))+o(t.css("padding-bottom"))),t.css(s.property,r-n+"px"))})}),f.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||null)}),a._maintainScroll&&e(window).scrollTop(c/d*e("html").outerHeight(!0)),this},a._applyDataApi=function(){var t={};e("[data-match-height], [data-mh]").each(function(){var n=e(this),o=n.attr("data-mh")||n.attr("data-match-height");o in t?t[o]=t[o].add(n):t[o]=n}),e.each(t,function(){this.matchHeight(!0)})};var s=function(t){a._beforeUpdate&&a._beforeUpdate(t,a._groups),e.each(a._groups,function(){a._apply(this.elements,this.options)}),a._afterUpdate&&a._afterUpdate(t,a._groups)};a._update=function(o,i){if(i&&"resize"===i.type){var r=e(window).width();if(r===t)return;t=r}o?-1===n&&(n=setTimeout(function(){s(i),n=-1},a._throttle)):s(i)},e(a._applyDataApi),e(window).bind("load",function(e){a._update(!1,e)}),e(window).bind("resize orientationchange",function(e){a._update(!0,e)})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9qcy9wYXR0ZXJucy1zcmMvcGF0dGVybnMtaG9tZS5qcyJdLCJuYW1lcyI6WyJlIiwidCIsIm4iLCJyIiwicyIsIm8iLCJ1IiwiYSIsInJlcXVpcmUiLCJpIiwiZiIsIkVycm9yIiwiY29kZSIsImwiLCJleHBvcnRzIiwiY2FsbCIsImxlbmd0aCIsMSwibW9kdWxlIiwid2luZG93IiwibW9iaWxlX25hdmlnYXRpb24iLCJub25fZmxleGJveF9ncmlkIiwiLi9wYXR0ZXJucy9tb2JpbGUtbmF2aWdhdGlvbi5qcyIsIi4vcGF0dGVybnMvbm9uLWZsZXhib3gtZ3JpZC5qcyIsMiwiZ2xvYmFsIiwiJCIsInRoYXQiLCJpbml0IiwiY2FjaGUiLCJtZWV0c1JlcXVpcmVtZW50cyIsImJpbmRFdmVudHMiLCIkYyIsIm1vYmlsZU5hdk1lbnVDb250YWluZXIiLCJtZW51SXRlbUNvdW50IiwiZXhpdCIsInJlcGxhY2VMYXN0TWVudUl0ZW0iLCJvbiIsImRpc3BsYXlNb3JlSXRlbXMiLCJzZXRTZWNvbmRDbGljayIsImhpZGVNb3JlSXRlbXMiLCJhZnRlciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJoYXNDbGFzcyIsInJlbW92ZU1lbnVDbGFzc2VzIiwidG9nZ2xlQ2xhc3MiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsInBhcmVudCIsInJlbW92ZUNsYXNzIiwic2VsZiIsMywiZ3JpZEl0ZW0iLCJtYXRjaEdyaWRJdGVtcyIsIm1hdGNoSGVpZ2h0IiwiYnlSb3ciLCJwcm9wZXJ0eSIsInRhcmdldCIsInJlbW92ZSIsIi4vdmVuZG9yL2pxdWVyeS5tYXRjaEhlaWdodC5qcyIsNCwiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsImpRdWVyeSIsIl9wcmV2aW91c1Jlc2l6ZVdpZHRoIiwiX3VwZGF0ZVRpbWVvdXQiLCJfcGFyc2UiLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJfcm93cyIsImVsZW1lbnRzIiwidG9sZXJhbmNlIiwiJGVsZW1lbnRzIiwibGFzdFRvcCIsInJvd3MiLCJlYWNoIiwiJHRoYXQiLCJ0b3AiLCJvZmZzZXQiLCJjc3MiLCJsYXN0Um93IiwicHVzaCIsIk1hdGgiLCJmbG9vciIsImFicyIsImFkZCIsIl9wYXJzZU9wdGlvbnMiLCJvcHRpb25zIiwib3B0cyIsImV4dGVuZCIsImZuIiwiX2dyb3VwcyIsImtleSIsImdyb3VwIiwibm90IiwiX2FwcGx5IiwidmVyc2lvbiIsIl90aHJvdHRsZSIsIl9tYWludGFpblNjcm9sbCIsIl9iZWZvcmVVcGRhdGUiLCJfYWZ0ZXJVcGRhdGUiLCJzY3JvbGxUb3AiLCJodG1sSGVpZ2h0Iiwib3V0ZXJIZWlnaHQiLCIkaGlkZGVuUGFyZW50cyIsInBhcmVudHMiLCJmaWx0ZXIiLCJkYXRhIiwiYXR0ciIsImRpc3BsYXkiLCJwYWRkaW5nLXRvcCIsInBhZGRpbmctYm90dG9tIiwibWFyZ2luLXRvcCIsIm1hcmdpbi1ib3R0b20iLCJib3JkZXItdG9wLXdpZHRoIiwiYm9yZGVyLWJvdHRvbS13aWR0aCIsImhlaWdodCIsIm92ZXJmbG93Iiwicm93IiwiJHJvdyIsInRhcmdldEhlaWdodCIsInN0eWxlIiwidmVydGljYWxQYWRkaW5nIiwiaXMiLCJfYXBwbHlEYXRhQXBpIiwiZ3JvdXBzIiwiJHRoaXMiLCJncm91cElkIiwiX3VwZGF0ZSIsInRocm90dGxlIiwidHlwZSIsIndpbmRvd1dpZHRoIiwid2lkdGgiLCJzZXRUaW1lb3V0IiwiYmluZCJdLCJtYXBwaW5ncyI6IkNBQUEsUUFBVUEsR0FBRUMsRUFBRUMsRUFBRUMsR0FBRyxRQUFTQyxHQUFFQyxFQUFFQyxHQUFHLElBQUlKLEVBQUVHLEdBQUcsQ0FBQyxJQUFJSixFQUFFSSxHQUFHLENBQUMsR0FBSUUsR0FBa0Isa0JBQVRDLFVBQXFCQSxPQUFRLEtBQUlGLEdBQUdDLEVBQUUsTUFBT0EsR0FBRUYsR0FBRSxFQUFJLElBQUdJLEVBQUUsTUFBT0EsR0FBRUosR0FBRSxFQUFJLElBQUlLLEdBQUUsR0FBSUMsT0FBTSx1QkFBdUJOLEVBQUUsSUFBSyxNQUFN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QUFYakMsUUFBeUJBLHFCQUNoSCIsImZpbGUiOiJhc3NldHMvanMvcGF0dGVybnMtaG9tZS5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4vLyB0aGlzIGlzIG1vc3RseSBmb3IgUGF0dGVybiBMaWJyYXJ5LCBhcyBXUCBkZWZpbmVzIG9uIGl0cyBvd25cbi8vZ2xvYmFsLmpRdWVyeSA9IHJlcXVpcmUoJ2pxdWVyeScpO1xuXG53aW5kb3cubW9iaWxlX25hdmlnYXRpb24gPSByZXF1aXJlKCcuL3BhdHRlcm5zL21vYmlsZS1uYXZpZ2F0aW9uLmpzJyk7XG53aW5kb3cubm9uX2ZsZXhib3hfZ3JpZCA9IHJlcXVpcmUoJy4vcGF0dGVybnMvbm9uLWZsZXhib3gtZ3JpZC5qcycpO1xufSx7XCIuL3BhdHRlcm5zL21vYmlsZS1uYXZpZ2F0aW9uLmpzXCI6MixcIi4vcGF0dGVybnMvbm9uLWZsZXhib3gtZ3JpZC5qc1wiOjN9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbihmdW5jdGlvbiAoZ2xvYmFsKXtcbi8qKlxuICogTW9iaWxlIE5hdmlnYXRpb24gTWVudVxuICovXG5tb2R1bGUuZXhwb3J0cyA9ICggZnVuY3Rpb24oIHdpbmRvdywgJCApIHtcblxuXHR2YXIgdGhhdCA9IHt9O1xuXHRcbiAgICAvLyBDb25zdHJ1Y3RvclxuICAgIHRoYXQuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGF0LmNhY2hlKCk7XG5cbiAgICAgICAgaWYgKCB0aGF0Lm1lZXRzUmVxdWlyZW1lbnRzICkge1xuICAgICAgICAgICAgdGhhdC5iaW5kRXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gQ2FjaGUgYWxsIHRoZSB0aGluZ3NcbiAgICB0aGF0LmNhY2hlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoYXQuJGMgPSB7XG4gICAgICAgICAgICB3aW5kb3c6ICQod2luZG93KSxcbiAgICAgICAgICAgIG1vYmlsZU5hdk1lbnVDb250YWluZXI6ICQoICcubW9iaWxlLW5hdi1tZW51JyApLFxuICAgICAgICAgICAgbWVudUl0ZW1Db3VudDogJCggJy5tb2JpbGUtbmF2LW1lbnUgLm1vYmlsZS1uYXYgPiBsaScgKS5sZW5ndGhcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLy8gQ29tYmluZSBhbGwgZXZlbnRzXG4gICAgdGhhdC5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgICBcdC8vIERvIG5vdGhpbmcgaWYgdGhlcmUgYXJlIG5vdCBtb3JlIHRoYW4gNSBsaW5rc1xuICAgIFx0aWYgKCB0aGF0LiRjLm1lbnVJdGVtQ291bnQgPD0gNSApIHtcbiAgICBcdFx0ZXhpdDtcbiAgICBcdH1cblxuICAgIFx0Ly8gUmVwbGFjZSB0aGUgZmlmdGggbWVudSBpdGVtIHdpdGggYSBcIm1vcmVcIiBsaW5rXG4gICAgXHR0aGF0LnJlcGxhY2VMYXN0TWVudUl0ZW0oKTtcblxuICAgIFx0Ly8gU2hvdyBtb3JlIGl0ZW1zIHdoZW4gdGhlIFwibW9yZVwiIGl0ZW0gaXMgY2xpY2tlZFxuICAgICAgICAkKCAnYm9keScgKS5vbiggJ2NsaWNrJywgJy5tb2JpbGUtbWVudS1tb3JlLWxpbmsnLCB0aGF0LmRpc3BsYXlNb3JlSXRlbXMgKTtcblxuICAgICAgICAvLyBBZGQgdGhlIG1vcmUgY2xhc3NlcyB3aGVuIGhvdmVyaW5nIGEgcGFyZW50IG1lbnUgaXRlbVxuICAgICAgICAkKCAnYm9keScgKS5vbiggJ2NsaWNrJywgJy5tb2JpbGUtbmF2LW1lbnUgLm1lbnUtaXRlbS1oYXMtY2hpbGRyZW4gYScsIHRoYXQuc2V0U2Vjb25kQ2xpY2sgKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBtZW51IHdoZW4gdGhlIGNsb3NlIGJ1dHRvbiBpcyBjbGlja2VkXG4gICAgICAgICQoICdib2R5JyApLm9uKCAnY2xpY2snLCAnLmNsb3NlLW1vYmlsZS1tZW51JywgdGhhdC5oaWRlTW9yZUl0ZW1zICk7XG4gICAgfTtcblxuICAgIC8vIERvIHdlIG1lZXQgdGhlIHJlcXVpcmVtZW50cz9cbiAgICB0aGF0Lm1lZXRzUmVxdWlyZW1lbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGF0LiRjLm1vYmlsZU5hdk1lbnVDb250YWluZXIubGVuZ3RoO1xuICAgIH07XG5cbiAgICAvLyBSZXBsYWNlIHRoZSBmaWZ0aCBtZW51IGl0ZW0gd2l0aCBhIFwibW9yZVwiIGxpbmtcbiAgICB0aGF0LnJlcGxhY2VMYXN0TWVudUl0ZW0gPSBmdW5jdGlvbigpIHtcblxuICAgIFx0Ly8gQnkgdGhpcyBwb2ludCwgd2Uga25vdyB3ZSBoYXZlIGF0IGxlYXN0IDUgaXRlbXNcbiAgICBcdC8vIEFkZCBvdXIgXCJtb3JlXCIgbGlua1xuXHRcdCQoICcubW9iaWxlLW5hdi1tZW51IC5tb2JpbGUtbmF2ID4gbGk6bnRoLWNoaWxkKDQpJyApLmFmdGVyKCAnPGxpIGNsYXNzPVwibW9iaWxlLW1lbnUtbW9yZS1saW5rXCI+PGEgaHJlZj1cIiNcIj48c3Bhbj48aSBjbGFzcz1cIm1vcmUtaWNvblwiPjwvaT5Nb3JlPC9zcGFuPjwvYT48L2xpPicgKTtcbiAgICB9XG5cbiAgICAvLyBUb2dnbGUgdGhlIG1lbnUgaXRlbXMgb24gYSBjbGljayBvZiB0aGUgXCJtb3JlXCIgbGlua1xuICAgIHRoYXQuZGlzcGxheU1vcmVJdGVtcyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBtZW51IGlmIGl0J3MgYWxyZWFkeSBvcGVuZWRcbiAgICAgICAgaWYgKCAkKCAnYm9keScgKS5oYXNDbGFzcyggJ21vYmlsZS1tZW51LW1vcmUnICkgJiYgISAkKCAnYm9keScgKS5oYXNDbGFzcyggJ3N1Yi1tZW51LW1vcmUnICkgKSB7XG4gICAgICAgICAgICB0aGF0LnJlbW92ZU1lbnVDbGFzc2VzKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW1vdmUgYW55IGluc3RhbmNlcyBvZiBjbGFzc2VzIGFscmVhZHkgaW4gcGxhY2VcbiAgICAgICAgLy8gVGhpcyBtYWtlcyBzdXJlIHdlIGNhbiBjbGljayB0byBzd2l0Y2ggYmV0d2VlbiBzdWJtZW51c1xuICAgICAgICB0aGF0LnJlbW92ZU1lbnVDbGFzc2VzKCk7XG5cbiAgICAgICAgdGhhdC4kYy5tb2JpbGVOYXZNZW51Q29udGFpbmVyLnRvZ2dsZUNsYXNzKCAnbW9yZScgKTtcbiAgICAgICAgJCggJ2JvZHknICkudG9nZ2xlQ2xhc3MoICdtb2JpbGUtbWVudS1tb3JlJyApO1xuXG4gICAgfTtcblxuICAgIC8vIExldCB0aGUgc3VibWVudSBwYXJlbnQgYmUgYSBub3JtYWwgbGluayBvbiB0aGUgc2Vjb25kIGNsaWNrXG4gICAgdGhhdC5zZXRTZWNvbmRDbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coICdjaGlsZCBjbGljaycsIHRoaXMgKTtcblxuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhpcyBwYXJlbnQgaGFzIHRoZSB2aXNpYmxlIGNsYXNzXG4gICAgICAgIGlmKCAhICQoIHRoaXMgKS5wYXJlbnQoICdsaScgKS5oYXNDbGFzcyggJ3Zpc2libGUnICkgKSB7XG5cbiAgICAgICAgICAgIC8vIERvbid0IGxldCB0aGUgbGluayBmaXJlIGFzIGEgbm9ybWFsIGxpbmtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW1vdmUgYW55IGluc3RhbmNlcyBvZiBjbGFzc2VzIGFscmVhZHkgaW4gcGxhY2VcbiAgICAgICAgLy8gVGhpcyBtYWtlcyBzdXJlIHdlIGNhbiBjbGljayB0byBzd2l0Y2ggYmV0d2VlbiBzdWJtZW51c1xuICAgICAgICB0aGF0LnJlbW92ZU1lbnVDbGFzc2VzKCk7XG5cbiAgICAgICAgLy8gVG9nZ2xlIHRoZSBjbGFzcyB0byBkaXNwbGF5IHRoZSBzdWJtZW51XG4gICAgICAgICQoIHRoaXMgKS5wYXJlbnQoICdsaScgKS50b2dnbGVDbGFzcyggJ3Zpc2libGUnICk7XG5cbiAgICAgICAgLy8gQWRkIG91ciBcIm1vcmVcIiBjbGFzc2VzIGFzIHdlIGRvIHdoZW4gY2xpY2tpbmcgdGhlIFwiTW9yZVwiIGxpbmtcbiAgICAgICAgdGhhdC4kYy5tb2JpbGVOYXZNZW51Q29udGFpbmVyLnRvZ2dsZUNsYXNzKCAnbW9yZScgKTtcbiAgICAgICAgJCggJ2JvZHknICkudG9nZ2xlQ2xhc3MoICdtb2JpbGUtbWVudS1tb3JlIHN1Yi1tZW51LW1vcmUnICk7XG4gICAgfTtcblxuICAgIC8vIEhpZGUgdGhlIG1lbnUgaXRlbXNcbiAgICB0aGF0LmhpZGVNb3JlSXRlbXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhhdC5yZW1vdmVNZW51Q2xhc3NlcygpO1xuICAgIH07XG5cbiAgICB0aGF0LnJlbW92ZU1lbnVDbGFzc2VzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGFueSBpbnN0YW5jZXMgb2YgY2xhc3NlcyBhbHJlYWR5IGluIHBsYWNlXG4gICAgICAgIC8vIFRoaXMgbWFrZXMgc3VyZSB3ZSBjYW4gY2xpY2sgdG8gc3dpdGNoIGJldHdlZW4gc3VibWVudXNcbiAgICAgICAgJCggJ2JvZHknICkucmVtb3ZlQ2xhc3MoICdtb2JpbGUtbWVudS1tb3JlIHN1Yi1tZW51LW1vcmUnICk7XG4gICAgICAgIHRoYXQuJGMubW9iaWxlTmF2TWVudUNvbnRhaW5lci5yZW1vdmVDbGFzcyggJ21vcmUnICk7XG4gICAgICAgICQoICcubWVudS1pdGVtLWhhcy1jaGlsZHJlbicgKS5yZW1vdmVDbGFzcyggJ3Zpc2libGUnICk7XG4gICAgfVxuXG4gICAgLy8gRW5nYWdlXG4gICAgJCggdGhhdC5pbml0ICk7XG5cdFxuXHRyZXR1cm4gdGhhdDtcblxufSkoIHdpbmRvdywgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pRdWVyeSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnalF1ZXJ5J10gOiBudWxsKSApO1xufSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30pXG59LHt9XSwzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbihmdW5jdGlvbiAoZ2xvYmFsKXtcbi8qKlxuICogTWF0Y2ggSGVpZ2h0XG4gKi9cbm1vZHVsZS5leHBvcnRzID0gKCBmdW5jdGlvbiggd2luZG93LCAkICkge1xuXG5cdHZhciB0aGF0ID0ge307XG5cdHZhciBtYXRjaEhlaWdodCA9IHJlcXVpcmUoICcuL3ZlbmRvci9qcXVlcnkubWF0Y2hIZWlnaHQuanMnICk7XG5cblx0Ly8gQ29uc3RydWN0b3IuXG5cdHRoYXQuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoYXQuY2FjaGUoKTtcblxuXHRcdGlmICggdGhhdC5tZWV0c1JlcXVpcmVtZW50cyApIHtcblx0XHRcdHRoYXQuYmluZEV2ZW50cygpO1xuXHRcdH1cblx0fTtcblxuXHQvLyBDYWNoZSBhbGwgdGhlIHRoaW5ncy5cblx0dGhhdC5jYWNoZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoYXQuJGMgPSB7XG5cdFx0XHR3aW5kb3c6ICQod2luZG93KSxcblx0XHRcdGdyaWRJdGVtOiAkKCAnLmdyaWQtaXRlbScgKSxcblx0XHR9O1xuXHR9O1xuXG5cdC8vIENvbWJpbmUgYWxsIGV2ZW50cy5cblx0dGhhdC5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhhdC4kYy53aW5kb3cub24oICdsb2FkJywgdGhhdC5tYXRjaEdyaWRJdGVtcyApO1xuXHR9O1xuXG5cdC8vIERvIHdlIG1lZXQgdGhlIHJlcXVpcmVtZW50cz9cblx0dGhhdC5tZWV0c1JlcXVpcmVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB0aGF0LiRjLmdyaWRJdGVtLmxlbmd0aDtcblx0fTtcblxuXHQvLyBNYXRjaCB0aGUgaGVpZ2h0IG9mIGFsbCB0aGUgY2FyZHMuXG5cdHRoYXQubWF0Y2hHcmlkSXRlbXMgPSBmdW5jdGlvbigpIHtcblx0XHR0aGF0LiRjLmdyaWRJdGVtLm1hdGNoSGVpZ2h0KHtcblx0XHRcdGJ5Um93OiB0cnVlLFxuXHRcdFx0cHJvcGVydHk6ICdoZWlnaHQnLFxuXHRcdFx0dGFyZ2V0OiBudWxsLFxuXHRcdFx0cmVtb3ZlOiBmYWxzZVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8vIEVuZ2FnZSFcblx0JCggdGhhdC5pbml0ICk7XG5cdFxuXHRyZXR1cm4gdGhhdDtcblxufSkoIHdpbmRvdywgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pRdWVyeSddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnalF1ZXJ5J10gOiBudWxsKSApO1xufSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30pXG59LHtcIi4vdmVuZG9yL2pxdWVyeS5tYXRjaEhlaWdodC5qc1wiOjR9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbihmdW5jdGlvbiAoZ2xvYmFsKXtcbi8qKlxuKiBqcXVlcnktbWF0Y2gtaGVpZ2h0IDAuNy4wIGJ5IEBsaWFicnVcbiogaHR0cDovL2JybS5pby9qcXVlcnktbWF0Y2gtaGVpZ2h0L1xuKiBMaWNlbnNlOiBNSVRcbiovXG5cbjsoZnVuY3Rpb24oZmFjdG9yeSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV4dHJhLXNlbWlcbiAgICAndXNlIHN0cmljdCc7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICAvLyBBTURcbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgLy8gQ29tbW9uSlNcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydqUXVlcnknXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2pRdWVyeSddIDogbnVsbCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdsb2JhbFxuICAgICAgICBmYWN0b3J5KGpRdWVyeSk7XG4gICAgfVxufSkoZnVuY3Rpb24oJCkge1xuICAgIC8qXG4gICAgKiAgaW50ZXJuYWxcbiAgICAqL1xuXG4gICAgdmFyIF9wcmV2aW91c1Jlc2l6ZVdpZHRoID0gLTEsXG4gICAgICAgIF91cGRhdGVUaW1lb3V0ID0gLTE7XG5cbiAgICAvKlxuICAgICogIF9wYXJzZVxuICAgICogIHZhbHVlIHBhcnNlIHV0aWxpdHkgZnVuY3Rpb25cbiAgICAqL1xuXG4gICAgdmFyIF9wYXJzZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIC8vIHBhcnNlIHZhbHVlIGFuZCBjb252ZXJ0IE5hTiB0byAwXG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSB8fCAwO1xuICAgIH07XG5cbiAgICAvKlxuICAgICogIF9yb3dzXG4gICAgKiAgdXRpbGl0eSBmdW5jdGlvbiByZXR1cm5zIGFycmF5IG9mIGpRdWVyeSBzZWxlY3Rpb25zIHJlcHJlc2VudGluZyBlYWNoIHJvd1xuICAgICogIChhcyBkaXNwbGF5ZWQgYWZ0ZXIgZmxvYXQgd3JhcHBpbmcgYXBwbGllZCBieSBicm93c2VyKVxuICAgICovXG5cbiAgICB2YXIgX3Jvd3MgPSBmdW5jdGlvbihlbGVtZW50cykge1xuICAgICAgICB2YXIgdG9sZXJhbmNlID0gMSxcbiAgICAgICAgICAgICRlbGVtZW50cyA9ICQoZWxlbWVudHMpLFxuICAgICAgICAgICAgbGFzdFRvcCA9IG51bGwsXG4gICAgICAgICAgICByb3dzID0gW107XG5cbiAgICAgICAgLy8gZ3JvdXAgZWxlbWVudHMgYnkgdGhlaXIgdG9wIHBvc2l0aW9uXG4gICAgICAgICRlbGVtZW50cy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgJHRoYXQgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIHRvcCA9ICR0aGF0Lm9mZnNldCgpLnRvcCAtIF9wYXJzZSgkdGhhdC5jc3MoJ21hcmdpbi10b3AnKSksXG4gICAgICAgICAgICAgICAgbGFzdFJvdyA9IHJvd3MubGVuZ3RoID4gMCA/IHJvd3Nbcm93cy5sZW5ndGggLSAxXSA6IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChsYXN0Um93ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gZmlyc3QgaXRlbSBvbiB0aGUgcm93LCBzbyBqdXN0IHB1c2ggaXRcbiAgICAgICAgICAgICAgICByb3dzLnB1c2goJHRoYXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgcm93IHRvcCBpcyB0aGUgc2FtZSwgYWRkIHRvIHRoZSByb3cgZ3JvdXBcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihNYXRoLmFicyhsYXN0VG9wIC0gdG9wKSkgPD0gdG9sZXJhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd3Nbcm93cy5sZW5ndGggLSAxXSA9IGxhc3RSb3cuYWRkKCR0aGF0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc3RhcnQgYSBuZXcgcm93IGdyb3VwXG4gICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCgkdGhhdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBsYXN0IHJvdyB0b3BcbiAgICAgICAgICAgIGxhc3RUb3AgPSB0b3A7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByb3dzO1xuICAgIH07XG5cbiAgICAvKlxuICAgICogIF9wYXJzZU9wdGlvbnNcbiAgICAqICBoYW5kbGUgcGx1Z2luIG9wdGlvbnNcbiAgICAqL1xuXG4gICAgdmFyIF9wYXJzZU9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBvcHRzID0ge1xuICAgICAgICAgICAgYnlSb3c6IHRydWUsXG4gICAgICAgICAgICBwcm9wZXJ0eTogJ2hlaWdodCcsXG4gICAgICAgICAgICB0YXJnZXQ6IG51bGwsXG4gICAgICAgICAgICByZW1vdmU6IGZhbHNlXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuICQuZXh0ZW5kKG9wdHMsIG9wdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIG9wdHMuYnlSb3cgPSBvcHRpb25zO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICBvcHRzLnJlbW92ZSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3B0cztcbiAgICB9O1xuXG4gICAgLypcbiAgICAqICBtYXRjaEhlaWdodFxuICAgICogIHBsdWdpbiBkZWZpbml0aW9uXG4gICAgKi9cblxuICAgIHZhciBtYXRjaEhlaWdodCA9ICQuZm4ubWF0Y2hIZWlnaHQgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBvcHRzID0gX3BhcnNlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICAvLyBoYW5kbGUgcmVtb3ZlXG4gICAgICAgIGlmIChvcHRzLnJlbW92ZSkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgZml4ZWQgaGVpZ2h0IGZyb20gYWxsIHNlbGVjdGVkIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLmNzcyhvcHRzLnByb3BlcnR5LCAnJyk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBzZWxlY3RlZCBlbGVtZW50cyBmcm9tIGFsbCBncm91cHNcbiAgICAgICAgICAgICQuZWFjaChtYXRjaEhlaWdodC5fZ3JvdXBzLCBmdW5jdGlvbihrZXksIGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXAuZWxlbWVudHMgPSBncm91cC5lbGVtZW50cy5ub3QodGhhdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVE9ETzogY2xlYW51cCBlbXB0eSBncm91cHNcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPD0gMSAmJiAhb3B0cy50YXJnZXQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGlzIGdyb3VwIHNvIHdlIGNhbiByZS1hcHBseSBsYXRlciBvbiBsb2FkIGFuZCByZXNpemUgZXZlbnRzXG4gICAgICAgIG1hdGNoSGVpZ2h0Ll9ncm91cHMucHVzaCh7XG4gICAgICAgICAgICBlbGVtZW50czogdGhpcyxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdHNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gbWF0Y2ggZWFjaCBlbGVtZW50J3MgaGVpZ2h0IHRvIHRoZSB0YWxsZXN0IGVsZW1lbnQgaW4gdGhlIHNlbGVjdGlvblxuICAgICAgICBtYXRjaEhlaWdodC5fYXBwbHkodGhpcywgb3B0cyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qXG4gICAgKiAgcGx1Z2luIGdsb2JhbCBvcHRpb25zXG4gICAgKi9cblxuICAgIG1hdGNoSGVpZ2h0LnZlcnNpb24gPSAnMC43LjAnO1xuICAgIG1hdGNoSGVpZ2h0Ll9ncm91cHMgPSBbXTtcbiAgICBtYXRjaEhlaWdodC5fdGhyb3R0bGUgPSA4MDtcbiAgICBtYXRjaEhlaWdodC5fbWFpbnRhaW5TY3JvbGwgPSBmYWxzZTtcbiAgICBtYXRjaEhlaWdodC5fYmVmb3JlVXBkYXRlID0gbnVsbDtcbiAgICBtYXRjaEhlaWdodC5fYWZ0ZXJVcGRhdGUgPSBudWxsO1xuICAgIG1hdGNoSGVpZ2h0Ll9yb3dzID0gX3Jvd3M7XG4gICAgbWF0Y2hIZWlnaHQuX3BhcnNlID0gX3BhcnNlO1xuICAgIG1hdGNoSGVpZ2h0Ll9wYXJzZU9wdGlvbnMgPSBfcGFyc2VPcHRpb25zO1xuXG4gICAgLypcbiAgICAqICBtYXRjaEhlaWdodC5fYXBwbHlcbiAgICAqICBhcHBseSBtYXRjaEhlaWdodCB0byBnaXZlbiBlbGVtZW50c1xuICAgICovXG5cbiAgICBtYXRjaEhlaWdodC5fYXBwbHkgPSBmdW5jdGlvbihlbGVtZW50cywgb3B0aW9ucykge1xuICAgICAgICB2YXIgb3B0cyA9IF9wYXJzZU9wdGlvbnMob3B0aW9ucyksXG4gICAgICAgICAgICAkZWxlbWVudHMgPSAkKGVsZW1lbnRzKSxcbiAgICAgICAgICAgIHJvd3MgPSBbJGVsZW1lbnRzXTtcblxuICAgICAgICAvLyB0YWtlIG5vdGUgb2Ygc2Nyb2xsIHBvc2l0aW9uXG4gICAgICAgIHZhciBzY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICBodG1sSGVpZ2h0ID0gJCgnaHRtbCcpLm91dGVySGVpZ2h0KHRydWUpO1xuXG4gICAgICAgIC8vIGdldCBoaWRkZW4gcGFyZW50c1xuICAgICAgICB2YXIgJGhpZGRlblBhcmVudHMgPSAkZWxlbWVudHMucGFyZW50cygpLmZpbHRlcignOmhpZGRlbicpO1xuXG4gICAgICAgIC8vIGNhY2hlIHRoZSBvcmlnaW5hbCBpbmxpbmUgc3R5bGVcbiAgICAgICAgJGhpZGRlblBhcmVudHMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkdGhhdCA9ICQodGhpcyk7XG4gICAgICAgICAgICAkdGhhdC5kYXRhKCdzdHlsZS1jYWNoZScsICR0aGF0LmF0dHIoJ3N0eWxlJykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyB0ZW1wb3JhcmlseSBtdXN0IGZvcmNlIGhpZGRlbiBwYXJlbnRzIHZpc2libGVcbiAgICAgICAgJGhpZGRlblBhcmVudHMuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG5cbiAgICAgICAgLy8gZ2V0IHJvd3MgaWYgdXNpbmcgYnlSb3csIG90aGVyd2lzZSBhc3N1bWUgb25lIHJvd1xuICAgICAgICBpZiAob3B0cy5ieVJvdyAmJiAhb3B0cy50YXJnZXQpIHtcblxuICAgICAgICAgICAgLy8gbXVzdCBmaXJzdCBmb3JjZSBhbiBhcmJpdHJhcnkgZXF1YWwgaGVpZ2h0IHNvIGZsb2F0aW5nIGVsZW1lbnRzIGJyZWFrIGV2ZW5seVxuICAgICAgICAgICAgJGVsZW1lbnRzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGF0ID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9ICR0aGF0LmNzcygnZGlzcGxheScpO1xuXG4gICAgICAgICAgICAgICAgLy8gdGVtcG9yYXJpbHkgZm9yY2UgYSB1c2FibGUgZGlzcGxheSB2YWx1ZVxuICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5ICE9PSAnaW5saW5lLWJsb2NrJyAmJiBkaXNwbGF5ICE9PSAnZmxleCcgJiYgZGlzcGxheSAhPT0gJ2lubGluZS1mbGV4Jykge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBjYWNoZSB0aGUgb3JpZ2luYWwgaW5saW5lIHN0eWxlXG4gICAgICAgICAgICAgICAgJHRoYXQuZGF0YSgnc3R5bGUtY2FjaGUnLCAkdGhhdC5hdHRyKCdzdHlsZScpKTtcblxuICAgICAgICAgICAgICAgICR0aGF0LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzogZGlzcGxheSxcbiAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctdG9wJzogJzAnLFxuICAgICAgICAgICAgICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnMCcsXG4gICAgICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogJzAnLFxuICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLWJvdHRvbSc6ICcwJyxcbiAgICAgICAgICAgICAgICAgICAgJ2JvcmRlci10b3Atd2lkdGgnOiAnMCcsXG4gICAgICAgICAgICAgICAgICAgICdib3JkZXItYm90dG9tLXdpZHRoJzogJzAnLFxuICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogJzEwMHB4JyxcbiAgICAgICAgICAgICAgICAgICAgJ292ZXJmbG93JzogJ2hpZGRlbidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBnZXQgdGhlIGFycmF5IG9mIHJvd3MgKGJhc2VkIG9uIGVsZW1lbnQgdG9wIHBvc2l0aW9uKVxuICAgICAgICAgICAgcm93cyA9IF9yb3dzKCRlbGVtZW50cyk7XG5cbiAgICAgICAgICAgIC8vIHJldmVydCBvcmlnaW5hbCBpbmxpbmUgc3R5bGVzXG4gICAgICAgICAgICAkZWxlbWVudHMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgJHRoYXQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICR0aGF0LmF0dHIoJ3N0eWxlJywgJHRoYXQuZGF0YSgnc3R5bGUtY2FjaGUnKSB8fCAnJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICQuZWFjaChyb3dzLCBmdW5jdGlvbihrZXksIHJvdykge1xuICAgICAgICAgICAgdmFyICRyb3cgPSAkKHJvdyksXG4gICAgICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gMDtcblxuICAgICAgICAgICAgaWYgKCFvcHRzLnRhcmdldCkge1xuICAgICAgICAgICAgICAgIC8vIHNraXAgYXBwbHkgdG8gcm93cyB3aXRoIG9ubHkgb25lIGl0ZW1cbiAgICAgICAgICAgICAgICBpZiAob3B0cy5ieVJvdyAmJiAkcm93Lmxlbmd0aCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb3cuY3NzKG9wdHMucHJvcGVydHksICcnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhlIHJvdyBhbmQgZmluZCB0aGUgbWF4IGhlaWdodFxuICAgICAgICAgICAgICAgICRyb3cuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHRoYXQgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSAkdGhhdC5hdHRyKCdzdHlsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheSA9ICR0aGF0LmNzcygnZGlzcGxheScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHRlbXBvcmFyaWx5IGZvcmNlIGEgdXNhYmxlIGRpc3BsYXkgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3BsYXkgIT09ICdpbmxpbmUtYmxvY2snICYmIGRpc3BsYXkgIT09ICdmbGV4JyAmJiBkaXNwbGF5ICE9PSAnaW5saW5lLWZsZXgnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGVuc3VyZSB3ZSBnZXQgdGhlIGNvcnJlY3QgYWN0dWFsIGhlaWdodCAoYW5kIG5vdCBhIHByZXZpb3VzbHkgc2V0IGhlaWdodCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNzcyA9IHsgJ2Rpc3BsYXknOiBkaXNwbGF5IH07XG4gICAgICAgICAgICAgICAgICAgIGNzc1tvcHRzLnByb3BlcnR5XSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAkdGhhdC5jc3MoY3NzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBtYXggaGVpZ2h0IChpbmNsdWRpbmcgcGFkZGluZywgYnV0IG5vdCBtYXJnaW4pXG4gICAgICAgICAgICAgICAgICAgIGlmICgkdGhhdC5vdXRlckhlaWdodChmYWxzZSkgPiB0YXJnZXRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldEhlaWdodCA9ICR0aGF0Lm91dGVySGVpZ2h0KGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldmVydCBzdHlsZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0eWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhhdC5hdHRyKCdzdHlsZScsIHN0eWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGF0LmNzcygnZGlzcGxheScsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB0YXJnZXQgc2V0LCB1c2UgdGhlIGhlaWdodCBvZiB0aGUgdGFyZ2V0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICB0YXJnZXRIZWlnaHQgPSBvcHRzLnRhcmdldC5vdXRlckhlaWdodChmYWxzZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhlIHJvdyBhbmQgYXBwbHkgdGhlIGhlaWdodCB0byBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICRyb3cuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkdGhhdCA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsUGFkZGluZyA9IDA7XG5cbiAgICAgICAgICAgICAgICAvLyBkb24ndCBhcHBseSB0byBhIHRhcmdldFxuICAgICAgICAgICAgICAgIGlmIChvcHRzLnRhcmdldCAmJiAkdGhhdC5pcyhvcHRzLnRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBwYWRkaW5nIGFuZCBib3JkZXIgY29ycmVjdGx5IChyZXF1aXJlZCB3aGVuIG5vdCB1c2luZyBib3JkZXItYm94KVxuICAgICAgICAgICAgICAgIGlmICgkdGhhdC5jc3MoJ2JveC1zaXppbmcnKSAhPT0gJ2JvcmRlci1ib3gnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsUGFkZGluZyArPSBfcGFyc2UoJHRoYXQuY3NzKCdib3JkZXItdG9wLXdpZHRoJykpICsgX3BhcnNlKCR0aGF0LmNzcygnYm9yZGVyLWJvdHRvbS13aWR0aCcpKTtcbiAgICAgICAgICAgICAgICAgICAgdmVydGljYWxQYWRkaW5nICs9IF9wYXJzZSgkdGhhdC5jc3MoJ3BhZGRpbmctdG9wJykpICsgX3BhcnNlKCR0aGF0LmNzcygncGFkZGluZy1ib3R0b20nKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBoZWlnaHQgKGFjY291bnRpbmcgZm9yIHBhZGRpbmcgYW5kIGJvcmRlcilcbiAgICAgICAgICAgICAgICAkdGhhdC5jc3Mob3B0cy5wcm9wZXJ0eSwgKHRhcmdldEhlaWdodCAtIHZlcnRpY2FsUGFkZGluZykgKyAncHgnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZXZlcnQgaGlkZGVuIHBhcmVudHNcbiAgICAgICAgJGhpZGRlblBhcmVudHMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkdGhhdCA9ICQodGhpcyk7XG4gICAgICAgICAgICAkdGhhdC5hdHRyKCdzdHlsZScsICR0aGF0LmRhdGEoJ3N0eWxlLWNhY2hlJykgfHwgbnVsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlc3RvcmUgc2Nyb2xsIHBvc2l0aW9uIGlmIGVuYWJsZWRcbiAgICAgICAgaWYgKG1hdGNoSGVpZ2h0Ll9tYWludGFpblNjcm9sbCkge1xuICAgICAgICAgICAgJCh3aW5kb3cpLnNjcm9sbFRvcCgoc2Nyb2xsVG9wIC8gaHRtbEhlaWdodCkgKiAkKCdodG1sJykub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qXG4gICAgKiAgbWF0Y2hIZWlnaHQuX2FwcGx5RGF0YUFwaVxuICAgICogIGFwcGxpZXMgbWF0Y2hIZWlnaHQgdG8gYWxsIGVsZW1lbnRzIHdpdGggYSBkYXRhLW1hdGNoLWhlaWdodCBhdHRyaWJ1dGVcbiAgICAqL1xuXG4gICAgbWF0Y2hIZWlnaHQuX2FwcGx5RGF0YUFwaSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZ3JvdXBzID0ge307XG5cbiAgICAgICAgLy8gZ2VuZXJhdGUgZ3JvdXBzIGJ5IHRoZWlyIGdyb3VwSWQgc2V0IGJ5IGVsZW1lbnRzIHVzaW5nIGRhdGEtbWF0Y2gtaGVpZ2h0XG4gICAgICAgICQoJ1tkYXRhLW1hdGNoLWhlaWdodF0sIFtkYXRhLW1oXScpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIGdyb3VwSWQgPSAkdGhpcy5hdHRyKCdkYXRhLW1oJykgfHwgJHRoaXMuYXR0cignZGF0YS1tYXRjaC1oZWlnaHQnKTtcblxuICAgICAgICAgICAgaWYgKGdyb3VwSWQgaW4gZ3JvdXBzKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXBzW2dyb3VwSWRdID0gZ3JvdXBzW2dyb3VwSWRdLmFkZCgkdGhpcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdyb3Vwc1tncm91cElkXSA9ICR0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhcHBseSBtYXRjaEhlaWdodCB0byBlYWNoIGdyb3VwXG4gICAgICAgICQuZWFjaChncm91cHMsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5tYXRjaEhlaWdodCh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgKiAgbWF0Y2hIZWlnaHQuX3VwZGF0ZVxuICAgICogIHVwZGF0ZXMgbWF0Y2hIZWlnaHQgb24gYWxsIGN1cnJlbnQgZ3JvdXBzIHdpdGggdGhlaXIgY29ycmVjdCBvcHRpb25zXG4gICAgKi9cblxuICAgIHZhciBfdXBkYXRlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKG1hdGNoSGVpZ2h0Ll9iZWZvcmVVcGRhdGUpIHtcbiAgICAgICAgICAgIG1hdGNoSGVpZ2h0Ll9iZWZvcmVVcGRhdGUoZXZlbnQsIG1hdGNoSGVpZ2h0Ll9ncm91cHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgJC5lYWNoKG1hdGNoSGVpZ2h0Ll9ncm91cHMsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbWF0Y2hIZWlnaHQuX2FwcGx5KHRoaXMuZWxlbWVudHMsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChtYXRjaEhlaWdodC5fYWZ0ZXJVcGRhdGUpIHtcbiAgICAgICAgICAgIG1hdGNoSGVpZ2h0Ll9hZnRlclVwZGF0ZShldmVudCwgbWF0Y2hIZWlnaHQuX2dyb3Vwcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbWF0Y2hIZWlnaHQuX3VwZGF0ZSA9IGZ1bmN0aW9uKHRocm90dGxlLCBldmVudCkge1xuICAgICAgICAvLyBwcmV2ZW50IHVwZGF0ZSBpZiBmaXJlZCBmcm9tIGEgcmVzaXplIGV2ZW50XG4gICAgICAgIC8vIHdoZXJlIHRoZSB2aWV3cG9ydCB3aWR0aCBoYXNuJ3QgYWN0dWFsbHkgY2hhbmdlZFxuICAgICAgICAvLyBmaXhlcyBhbiBldmVudCBsb29waW5nIGJ1ZyBpbiBJRThcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUgPT09ICdyZXNpemUnKSB7XG4gICAgICAgICAgICB2YXIgd2luZG93V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICAgICAgICAgIGlmICh3aW5kb3dXaWR0aCA9PT0gX3ByZXZpb3VzUmVzaXplV2lkdGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfcHJldmlvdXNSZXNpemVXaWR0aCA9IHdpbmRvd1dpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGhyb3R0bGUgdXBkYXRlc1xuICAgICAgICBpZiAoIXRocm90dGxlKSB7XG4gICAgICAgICAgICBfdXBkYXRlKGV2ZW50KTtcbiAgICAgICAgfSBlbHNlIGlmIChfdXBkYXRlVGltZW91dCA9PT0gLTEpIHtcbiAgICAgICAgICAgIF91cGRhdGVUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfdXBkYXRlKGV2ZW50KTtcbiAgICAgICAgICAgICAgICBfdXBkYXRlVGltZW91dCA9IC0xO1xuICAgICAgICAgICAgfSwgbWF0Y2hIZWlnaHQuX3Rocm90dGxlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKlxuICAgICogIGJpbmQgZXZlbnRzXG4gICAgKi9cblxuICAgIC8vIGFwcGx5IG9uIERPTSByZWFkeSBldmVudFxuICAgICQobWF0Y2hIZWlnaHQuX2FwcGx5RGF0YUFwaSk7XG5cbiAgICAvLyB1cGRhdGUgaGVpZ2h0cyBvbiBsb2FkIGFuZCByZXNpemUgZXZlbnRzXG4gICAgJCh3aW5kb3cpLmJpbmQoJ2xvYWQnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBtYXRjaEhlaWdodC5fdXBkYXRlKGZhbHNlLCBldmVudCk7XG4gICAgfSk7XG5cbiAgICAvLyB0aHJvdHRsZWQgdXBkYXRlIGhlaWdodHMgb24gcmVzaXplIGV2ZW50c1xuICAgICQod2luZG93KS5iaW5kKCdyZXNpemUgb3JpZW50YXRpb25jaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBtYXRjaEhlaWdodC5fdXBkYXRlKHRydWUsIGV2ZW50KTtcbiAgICB9KTtcblxufSk7XG5cbn0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9KVxufSx7fV19LHt9LFsxXSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
